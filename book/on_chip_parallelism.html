<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>On-Chip Parallelism (theory) - cracking-the-perf-interview</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="on_chip_parallelism.html" class="active"><strong aria-hidden="true">2.</strong> On-Chip Parallelism (theory)</a></li><li class="chapter-item expanded "><a href="estimation/estimation.html"><strong aria-hidden="true">3.</strong> Estimating Performance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="estimation/compute.html"><strong aria-hidden="true">3.1.</strong> How to Compute It?</a></li><li class="chapter-item expanded "><a href="estimation/example.html"><strong aria-hidden="true">3.2.</strong> Practical Example</a></li><li class="chapter-item expanded "><a href="estimation/roofline.html"><strong aria-hidden="true">3.3.</strong> Roofline Model</a></li><li class="chapter-item expanded "><a href="estimation/questions.html"><strong aria-hidden="true">3.4.</strong> Interview Questions</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">cracking-the-perf-interview</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="on-chip-parallelism"><a class="header" href="#on-chip-parallelism">On-Chip Parallelism</a></h1>
<p>Machine Learning workloads require more and more computational power as we scale the number of parameters, the context lengths, and the amount of data we ingest. At the same time, chip design has hit a plateau; it is getting prohibitively expensive to increase the number of operations a chip can do per second. Furthermore, memory latency and bandwidth have not been keeping up with the increases in compute speed, implying that computational power cannot be fully leveraged because the data cannot be moved as fast as it is being processed. We cannot rely on faster chips, so we instead rely on <strong>the chips doing more at the same time</strong> either by doing multiple operations at once or having multiple cores working together in parallel.</p>
<h2 id="sequential-execution-model"><a class="header" href="#sequential-execution-model">Sequential execution model</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Von_Neumann_architecture">Traditional chips were thought of as having two main blocks</a>; the memory (RAM) and the Central Processing Unit (CPU.)</p>
<p>Traditional software is usually written with this implied model:</p>
<ol>
<li>Load some scalars from RAM to the CPU</li>
<li>Do some operations on the CPU</li>
<li>Write back the output of those operations to RAM</li>
<li>Repeat for the next instruction</li>
</ol>
<p>While this model is great and allowed us to write most of the software running the world today; it has long become incoherent with the way chips actually process data. We let the compilers and the chips themselves rewrite our code to make better use of the actual capabilities of the hardware; mostly through different levels of parallelism and better memory access patterns.</p>
<h2 id="the-different-levels-of-on-chip-parallelism"><a class="header" href="#the-different-levels-of-on-chip-parallelism">The different levels of on-chip parallelism</a></h2>
<p>Modern chips are all inherently parallel. Whether they are GPUs, TPUs, or modern CPUs. They also all feature different types of parallelism that need to be exploited to maximize the chip's utilisation. Exploiting these mechanisms is not always explicit because compilers are reasonably good at leveraging target architectures's features. Some chips are also capable of rewriting the machine code they receive before executing it.</p>
<h3 id="io-parallelism"><a class="header" href="#io-parallelism">IO parallelism</a></h3>
<p>The processing unit and the memory are two independent units. Therefore, the processor is able to perform computations independently of the memory reads and writes. For instance, it can request some data from RAM as well as perform an addition between two numbers it has already loaded while waiting for the data to be received. This means we can potentially completely overlap computation times with memory movements. In our execution model, steps 1, 2, and 3 can all be executed in parallel.</p>
<h3 id="single-instruction-multiple-data-simd"><a class="header" href="#single-instruction-multiple-data-simd">Single Instruction Multiple Data (<a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">SIMD</a>)</a></h3>
<p>Most modern chips are capable of executing a single instruction on multiple elements at once. This can mean adding two vectors with one another in one cycle, reducing (ie. summing) a vector into a scalar, or even running a matrix dot product within specialized Arithmetic Logic Units (ALUs) in TPUs' and GPUs' tensor cores.</p>
<ul>
<li>Modern x86 chips feature AVX registers</li>
<li>TPUs have MXUs for matrix dot products, VPUs for elementwise vectorized operations, and XLUs for reductions</li>
<li>GPUs have tensor cores for matrix dot products</li>
</ul>
<p>Coming back to our execution model. Instead of executing one operation at a time on scalars, we instead perform as many operations as we can in parallel within a SIMD unit and also load more data at once since our registers are larger.</p>
<h3 id="instruction-level-parallelism"><a class="header" href="#instruction-level-parallelism">Instruction Level Parallelism</a></h3>
<p>As we have mentioned, modern chips possess multiple circuits that specialize in the handling of different data types and operations. For instance, TPUs have MXUs and VPUs. Some of these circuits can also be used independently. For instance, we could compute a dot product on the MXU, and apply a ReLU activation at the same time on the VPU (more specifically, perform a dot product, write the output to the VPU, do the next dot product at the same time as we apply ReLU on the VPU.)</p>
<h3 id="multiple-threads-of-execution"><a class="header" href="#multiple-threads-of-execution">Multiple threads of execution</a></h3>
<p>Finally, modern architectures usually feature multiple processing units that can execute operations independently of one another. This is the main differentiator of GPUs which possess thousands of cores that can all execute operations in parallel on different data addresses. This model comes with additional complexities such as the need to synchronize data across cores safely and efficiently.</p>
<p>Coming back to the original model, we now execute the model multiple times in parallel.</p>
<h2 id="comparison-of-on-chip-parallelism"><a class="header" href="#comparison-of-on-chip-parallelism">Comparison of On-Chip Parallelism</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Parallelism Type</th><th style="text-align: left">Core Concept</th><th style="text-align: left">‚öôÔ∏è Hardware Example</th><th style="text-align: left">üíª Software Abstraction</th><th style="text-align: left">üë§ Who Implements This?</th></tr></thead><tbody>
<tr><td style="text-align: left"><strong>IO parallelism</strong></td><td style="text-align: left">Hiding memory latency by performing computation while waiting for data to be fetched.</td><td style="text-align: left">GPU warp schedulers swapping threads stalled on memory reads; hardware prefetchers.</td><td style="text-align: left">Optimized kernels (e.g., in cuDNN, XLA).</td><td style="text-align: left"><strong>Chip Hardware</strong> (schedulers) &amp; <strong>Compiler</strong> (instruction scheduling).</td></tr>
<tr><td style="text-align: left"><strong>SIMD</strong> <br/> (Single Instruction, Multiple Data)</td><td style="text-align: left">One instruction operating on many data elements (a vector) at once.</td><td style="text-align: left">GPU Tensor Cores (for matrices), TPU MXUs, CPU AVX registers.</td><td style="text-align: left">Vectorized code (e.g., <code>a + b</code> on tensors), <code>torch.matmul</code>.</td><td style="text-align: left"><strong>Compiler / Library</strong> (e.g., cuDNN, XLA). The programmer <em>enables</em> this by using high-level vector/matrix ops.</td></tr>
<tr><td style="text-align: left"><strong>Instruction-Level Parallelism</strong> <br/> (Using Multiple ALUs)</td><td style="text-align: left">Using different, specialized execution units (ALUs) within a core at the same time.</td><td style="text-align: left">A TPU pipelining work from its MXU (matrix) to its VPU (vector).</td><td style="text-align: left"><strong>Kernel Fusion</strong> (e.g., <code>matmul + relu</code> in one operation).</td><td style="text-align: left"><strong>Compiler</strong> (e.g., <code>jax.jit</code>, XLA). The chip hardware makes it possible.</td></tr>
<tr><td style="text-align: left"><strong>Multithreading / Multicore</strong> <br/> (MIMD / SIMT)</td><td style="text-align: left">Multiple processing units (cores) executing instructions independently.</td><td style="text-align: left">Multi-core CPU (MIMD), thousands of CUDA Cores on a GPU (SIMT).</td><td style="text-align: left"><strong>Data Parallelism</strong> (splitting a batch over cores) or Model Parallelism.</td><td style="text-align: left"><strong>Programmer &amp; Library</strong> (e.g., CUDA, which manages threads for kernels).</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="estimation/estimation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="estimation/estimation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
